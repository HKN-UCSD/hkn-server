const functions = require('firebase-functions');
const admin = require('firebase-admin');
admin.initializeApp();
const db = admin.firestore();
const settings = { timestampsInSnapshots: true };
db.settings(settings);

const whitelist = new Set([
    'rmalharb@ucsd.edu',
    'amarumug@ucsd.edu',
    'aateek@ucsd.edu',
    'sbinnani@ucsd.edu',
    'jbbisarr@ucsd.edu',
    'lironbc@yahoo.com',
    'jmcarson@ucsd.edu',
    'bchau@ucsd.edu',
    'avganesh@ucsd.edu',
    'ahorodni@eng.ucsd.edu',
    'Kehulse@ucsd.edu',
    'abiyer@ucsd.edu',
    'akjalan@ucsd.edu',
    's9jiang@ucsd.edu',
    'rkope@ucsd.edu',
    'gul002@ucsd.edu',
    'nlimit@ucsd.edu',
    'cmliu@ucsd.edu',
    'til207@ucsd.edu',
    'kamanick@ucsd.edu',
    'smansuri@ucsd.edu',
    'tmarback@ucsd.edu',
    'hmurguia@ucsd.edu',
    'p2narasi@ucsd.edu',
    'spasumar@ucsd.edu',
    'npathak@ucsd.edu',
    'rsheth@ucsd.edu',
    'j8shi@ucsd.edu',
    'istokes@eng.ucsd.edu',
    'svempati@ucsd.edu',
    'jiw609@ucsd.edu',
    'yuw485@ucsd.edu',
    'gew013@ucsd.edu',
    'tix034@ucsd.edu',
    'rkyamamo@ucsd.edu',
    'yiy287@ucsd.edu',
    'yiy170@ucsd.edu',
    'j3zeng@ucsd.edu',
    'ziz361@ucsd.edu',
    'liz222@ucsd.edu',
    'pamidon@ucsd.edu',
    'zbabbitt@ucsd.edu',
    'elb003@ucsd.edu',
    'mibryant@ucsd.edu',
    'nburdick@ucsd.edu',
    'ptcheng@ucsd.edu',
    'wac022@ucsd.edu',
    'Jedara@ucsd.edu',
    'hmeid@ucsd.edu',
    'rag031@ucsd.edu',
    'regreer@ucsd.edu',
    'arg061@ucsd.edu',
    'dharnant@ucsd.edu',
    'j1hsieh@ucsd.edu',
    'w1huang@ucsd.edu',
    'shuen@ucsd.edu',
    't1jain@ucsd.edu',
    'nkibria@ucsd.edu ',
    'a5le@ucsd.edu',
    'Njl002@ucsd.edu',
    'yel106@ucsd.edu',
    'rul124@ucsd.edu',
    'kvlorenz@ucsd.edu',
    'awma@ucsd.edu',
    'gmaki@ucsd.edu',
    'eugalde@ucsd.edu',
    'jcm047@ucsd.edu',
    'samondal@eng.ucsd.edu',
    'cnietogr@ucsd.edu',
    'zhp012@ucsd.edu',
    'aaporter@ucsd.edu',
    'mrubenac@ucsd.edu',
    'ksoloway@ucsd.edu',
    'Xis142@ucsd.edu',
    'apsylves@ucsd.edu ',
    'ket037@ucsd.edu',
    'hjw005@ucsd.edu',
    'duy003@ucsd.edu',
    'eziaeika@ucsd.edu',
    'zhz402@ucsd.edu',
    'abhanage@eng.ucsd.edu',
    'sic143@ucsd.edu',
    'juc159@ucsd.edu',
    'Mac216@eng.ucsd.edu',
    'lfriley@ucsd.edu',
    'ang121@ucsd.edu',
    'shh176@ucsd.edu',
    'j8jia@ucsd.edu',
    'l1lang@ucsd.edu',
    'jil026@ucsd.edu',
    'ehlin@ucsd.edu',
    'kmlui@ucsd.edu',
    'wim003@ucsd.edu',
    'VMiranda@ucsd.edu',
    'namishra@ucsd.edu',
    'nqn013@ucsd.edu',
    'nlpathak@eng.ucsd.edu',
    'mep011@ucsd.edu',
    'frushton@ucsd.edu',
    'zsrostli@eng.ucsd.edu',
    'smt021@ucsd.edu',
    'gvalliap@ucsd.edu',
    'ivivchar@ucsd.edu',
    'chw357@ucsd.edu',
    'rux019@ucsd.edu',
    'yiy116@ucsd.edu',
    'ayessenb@ucsd.edu',
    'biz003@ucsd.edu',
    'nkbansal@ucsd.edu',
    'jabao@ucsd.edu',
    'mboulgak@ucsd.edu',
    'jchazen@ucsd.edu',
    'brc019@ucsd.edu',
    'yhc001@ucsd.edu',
    'cacunnin@ucsd.edu',
    'zkdeng@ucsd.edu',
    'b7du@ucsd.edu',
    'Hfaulsti@ucsd.edu',
    'mmgo@ucsd.edu',
    'yih159@ucsd.edu',
    'all123@ucsd.edu',
    'bbl003@ucsd.edu',
    'mil209@ucsd.edu',
    'aliou@ucsd.edu',
    'clohrli@ucsd.edu',
    'gmakmur@ucsd.edu',
    'w6mao@ucsd.edu',
    'han015@ucsd.edu',
    't1pan@ucsd.edu',
    'opandiya@ucsd.edu',
    'ebperez@ucsd.edu',
    'graskovi@ucsd.edu',
    'jir017@ucsd.edu',
    'mhrice@ucsd.edu',
    'krungta@ucsd.edu',
    'arsehgal@ucsd.edu',
    'ajshahin@ucsd.edu',
    'jls016@ucsd.edu',
    'jos047@ucsd.edu',
    'jis126@ucsd.edu',
    'ant047@ucsd.edu',
    'jtt049@ucsd.edu',
    'kaw063@ucsd.edu',
    'Yix176@ucsd.edu ',
    'ayonamin@ucsd.edu',
    'abyoo@ucsd.edu',
    't2zaw@ucsd.edu',
    'miz082@ucsd.edu',
    'liz147@ucsd.edu',
    'h7cai@ucsd.edu',
    'gchau@ucsd.edu',
    'Phhayes@eng.ucsd.edu',
    'jkadifa@ucsd.edu',
    'klevick@ucsd.edu',
    'a3mathur@ucsd.edu',
    'esp009@ucsd.edu',
    'ssrey@ucsd.edu',
    'clt020@ucsd.edu',
    'tworley@ucsd.edu',
    'roxi@ucsd.edu',
    'ddurubeh@ucsd.edu',
    'bmhenriq@ucsd.edu',
    'wej014@ucsd.edu',
    'aknopes@ucsd.edu',
    'dlakshmi@ucsd.edu',
    'tnl015@ucsd.edu',
    'smliu@ucsd.edu',
    'dpazruiz@ucsd.edu',
    'jur009@ucsd.edu',
    'm1sathe@ucsd.edu',
    'Vsmirnov@ucsd.edu',
    'jot035@ucsd.edu',
    'nwahal@ucsd.edu',
    'jhy015@ucsd.edu',
    'm9yu@ucsd.edu',
    'j1burke@ucsd.edu',
    'ecfisher@ucsd.edu',
    'c2gong@ucsd.edu',
    'aagraham@ucsd.edu',
    'h8hu@ucsd.edu',
    'shj003@ucsd.edu',
    'wnliang@ucsd.edu',
    'dorozco@ucsd.edu',
    'atp022@ucsd.edu',
    'mranis@ucsd.edu',
    'Dgriley@ucsd.edu',
    'ssunarjo@ucsd.edu',
    's3wan@ucsd.edu',
    'xiz170@ucsd.edu',
    'T5allen@ucsd.edu',
    'vbarbosa@ucsd.edu',
    'amchung@ucsd.edu',
    'adcoffma@ucsd.edu',
    'crellis@ieee.org',
    'n1jenkin@ucsd.edu',
    'jiao.max@gmail.com',
    'ckoguchi@ucsd.edu',
    'akannan@ucsd.edu',
    'lawchihon@ymail.com',
    'cal027@ucsd.edu',
    'llubrico@ucsd.edu',
    'jnajjar@ucsd.edu',
    'k1newcom@ucsd.edu',
    'jnn004@ucsd.edu',
    'monalp408@gmail.com',
    'Persekiana@gmail.com',
    'vpukasam@ucsd.edu',
    'aqu@ucsd.edu',
    'mar076@ucsd.edu',
    'bsenne@ucsd.edu',
    'kqt004@ucsd.edu',
    'meyazdan@ucsd.edu',
    'andrew.s.saad@gmail.com',
    'TJDawkins@ucsd.edu',
    'colinkeef@gmail.com',
    'z3meng@ucsd.edu',
    'pcyoon@ucsd.edu',
    'snowluck2345@gmail.com',
    'mralam@ucsd.edu',
    'wkalsafi@gmail.com',
    'bandika@ucsd.edu',
    'awc002@ucsd.edu',
    'anniechen310@gmail.com',
    'eswardhinak@gmail.com',
    'cgalac@ucsd.edu',
    'ggesirie@ucsd.edu ',
    's8guo@ucsd.edu',
    'kts1mg@gmail.com',
    'elhe@ucsd.edu',
    'jaime@ucsd.edu',
    'pjan89@gmail.com',
    'sohamj09@gmail.com',
    'jgkam@ucsd.edu',
    'lhl006@ucsd.edu',
    'deli@ucsd.edu',
    'ntli@ucsd.edu',
    'celogan@ucsd.edu',
    'c3luong@ucsd.edu',
    'danucsd2017@gmail.com ',
    'c3mccabe@gmail.com',
    'kvn016@ucsd.edu',
    'lapage@ucsd.edu',
    'rpatron@ucsd.edu',
    'jakerozelle12@gmail.com',
    'dsalinas@ucsd.edu',
    'wesheng@ucsd.edu',
    'kspotkae@ucsd.edu',
    'ais003@ucsd.edu',
    'clarencetan329@gmail.com',
    'ctarangi@ucsd.edu',
    'k4thai@ucsd.edu',
    'ltindall@ucsd.edu',
    'jtroyer@ucsd.edu',
    'kainu.ht@gmail.com',
    'tctsai@ucsd.edu',
    'aty@ucsd.edu',
    'munanian@ucsd.edu',
    'qiw033@ucsd.edu ',
    'vincentkyeh@gmail.com',
    'z4zeng@ucsd.edu',
    'maverina@hotmail.com',
    'samuellbauza@gmail.com',
    'mcc007@ucsd.edu',
    'oguerrer@ucsd.edu',
    'maxhughes7743@gmail.com',
    'ninad.kulkarni24@gmail.com',
    'jo3luttrell@gmail.com',
    'tcn006@ucsd.edu',
    'pnorris@ucsd.edu',
    'bsearle@ucsd.edu',
    'deshen@ucsd.edu',
    'jslaton@ucsd.edu',
    'x5tong@ucsd.edu',
    'borhanvasli@gmail.com',
    'geraldwjy@gmail.com',
    'vhyu@eng.ucsd.edu',
    'pbarrina@ucsd.edu',
    'kbarronk@ucsd.edu',
    'scornett@ucsd.edu',
    'd1dong@ucsd.edu',
    'dcduncan@ucsd.edu',
    'myhe@ucsd.edu',
    'bhedayat@ucsd.edu',
    'dustinhudson@me.com',
    'a4kaur@ucsd.edu',
    'sushant.2294@gmail.com',
    'w1kwan@ucsd.edu',
    'dnl001@ucsd.edu',
    'jleblanc@ucsd.edu',
    'chl218@ucsd.edu',
    'jom027@ucsd.edu',
    'nmillias@ucsd.edu',
    'sphu@ucsd.edu',
    'arvind.rao.us@ieee.org',
    't5thai@ucsd.edu',
    'mhvasque@ucsd.edu',
    'jwada@ucsd.edu',
    'ssw021@ucsd.edu',
    'a8xu@ucsd.edu',
    'stborden@gmail.com',
    'anc041@ucsd.edu',
    'rcericks@ucsd.edu',
    'mgooch@ucsd.edu',
    'sallyylaw@gmail.com',
    'i3liu@ucsd.edu',
    'hmangalo@ucsd.edu',
    'ksomers@ucsd.edu',
    'sammie.a.wang@jacobs.ucsd.edu',
    'rcwhalen@ucsd.edu',
    'kwilkers@ucsd.edu',
    'tpdell@ucsd.edu',
    'ktgustaf@ucsd.edu',
    'alhe@ucsd.edu',
    'kvn007@ucsd.edu',
    'overbey.e@gmail.com',
    'heqin@ucsd.edu',
    'bhaskara.rupakula@gmail.com',
    'dasmith@ucsd.edu',
    'akso@ucsd.edu',
    'wavillan@ucsd.edu',
    'd6lau@ucsd.edu',
    'judyclinn@gmail.com',
    'bryan.ransil@gmail.com',
    'milessanner@gmail.com',
    'sean@cognoseed.org',
    'jsyoung@ucsd.edu',
    'wiguo@ucsd.edu',
    'lui.shun.hei@gmail.com',
    'mast.ryan@gmail.com',
    'j5chan@ucsd.edu',
    'fychang@ucsd.edu',
    'whcheuk@ucsd.edu',
    'bellis@ucsd.edu',
    'dyl010@ucsd.edu',
    'ktnagata@ucsd.edu',
    'crebert@ucsd.edu',
    'mfsilva@ucsd.edu',
    'isimpelo@ucsd.edu',
    'bobbytang.business@gmail.com',
    'atengamn@ucsd.edu',
    'jenswang@ucsd.edu',
    'williamlu1367@gmail.com',
    'hphuong@ucsd.edu',
    'wong.allen.s@gmail.com',
    'christyannaz@gmail.com',
    'nfarahba@ucsd.edu',
    'kevin.t.hansen@gmail.com',
    'khhuynh@ucsd.edu',
    'tkuwayam@ucsd.edu',
    'ayliang@ucsd.edu',
    'jmalihan@ucsd.edu',
    'agatha.man@gmail.com',
    'spencersim@gmail.com',
    'gyamasak@ucsd.edu',
    'mabel.m.zhang@gmail.com',
    'ccalkins@ucsd.edu',
    'd7chang@ucsd.edu',
    'rjc002@ucsd.edu',
    'sechen@ucsd.edu',
    'jsc009@ucsd.edu',
    'fcongson@gmail.com',
    'acorelli@ucsd.edu',
    'lihu@ucsd.edu',
    'jjhuang@ucsd.edu',
    'Jly006@gmail.com',
    'mnekraso@ucsd.edu',
    'sandrashih06@yahoo.com',
    'sockleg@ucsd.edu',
    'aalaviza@ucsd.edu',
    'vbhalodi@ucsd.edu',
    'mbrigant@ucsd.edu',
    'whcheung616@gmail.com',
    'ansumd@gmail.com',
    'lgilpin@ucsd.edu',
    'dgovea@ucsd.edu',
    'jdli@ucsd.edu',
    't6martin@ucsd.edu',
    'jan009@ucsd.edu',
    'sshelech@ucsd.edu',
    'jxtan@ucsd.edu',
    'mtartre@gmx.com',
    'rclaus@ucsd.edu',
    'rhfang@ucsd.edu',
    'jasmer.jiao@gmail.com',
    'jrl001@ucsd.edu',
    'brianlee87@gmail.com',
    'andytcleung@hotmail.com',
    'jtl005@ucsd.edu',
    'x1lu@ucsd.edu',
    'ryatchak@ucsd.edu',
    'lbai@ucsd.edu',
    'yec002@ucsd.edu',
    'bwjones@ucsd.edu',
    'bjungman@ucsd.edu',
    'PatrickPakLinNg@gmail.com',
    'ericjnowell@gmail.com',
    'jcshih@ucsd.edu',
    'jzhao@ucsd.edu',
    'me.carter@yahoo.com',
    'AnsonHsu1@gmail.com',
    'adityakher@sbcglobal.net',
    'sylui@ucsd.edu',
    'stuff_jordan@metacrawler.com',
    'knip@ucsd.edu',
    'bstieber@ucsd.edu',
    'tasu@ucsd.edu',
    'dsugimur@ucsd.edu',
    't2truong@ucsd.edu',
    'dagsalon@ucsd.edu',
    'dtchung@gmail.com',
    'lindsayanndavis@gmail.com',
    'Sjfernan@ucsd.edu',
    'jwlien@ucsd.edu',
    'pling@ucsd.edu',
    'stn001@ucsd.edu',
    'bnhong@ucsd.edu',
    'nrazmehr@yahoo.com',
    'alexta6@hotmail.com',
    'jhw003@ucsd.edu',
    'lgreiner@ucsd.edu',
    'baho@ucsd.edu',
    'cyhung@ucsd.edu',
    'yujiang@ucsd.edu',
    'jklau@ucsd.edu',
    'dleu@ucsd.edu',
    'rmanzano@ucsd.edu',
    'jmounzer@ucsd.edu',
    'joshuayhng@gmail.com',
    'pank12@hotmail.com',
    'gprior@ucsd.edu',
    'cwrudy@ucsd.edu',
    'akshieh@ucsd.edu',
    'tstahlbu@ucsd.edu',
    'tammy2000@aol.com',
    'JamesLTong@gmail.com',
    'mtotten@ucsd.edu',
    'yk_trinh@yahoo.com',
    'jwindmiller@san.rr.com',
    'exu@ucsd.edu',
    'rying@ucsd.edu',
    'qkennett@ucsd.edu',
    'sjl006@ucsd.edu',
    'cnoble@ucsd.edu'
])    

exports.onCreateUser = functions.auth.user().onCreate((user) => {
    if (whitelist.has(user.email)) {
        console.log('Setting member privilege')
        return admin.auth().setCustomUserClaims(user.uid, {member: true})
            .then(() => {
                return db.collection('users').doc(user.uid).set({email : user.email})
            })
            .catch(error => {
                console.log(error)
            })
    } else {
        console.log('Deleting an user based on the whitelist')
        return admin.auth().deleteUser(user.uid)  
            .catch(error => {
                console.log(error)
            })   
    }
});

exports.onDeleteUser = functions.auth.user().onDelete((user) => {
    return db.collection('users').doc(user.uid).delete()
        .then(() => {
            console.log("Successfully removed user's data.");
            return 0;
        })
        .catch(error => {
            console.log(error);
        })
});